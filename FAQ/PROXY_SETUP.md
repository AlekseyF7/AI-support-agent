# Настройка прокси для OpenAI API

## Проблема

Если вы получаете ошибку:
```
Error code: 403 - {'error': {'code': 'unsupported_country_region_territory', ...}}
```

Это означает, что OpenAI API недоступен в вашем регионе.

## Решение: Использование прокси

### Вариант 1: HTTP/HTTPS прокси

1. Получите прокси-сервер (HTTP/HTTPS), который работает в регионе, где доступен OpenAI API.

2. Добавьте в файл `.env`:
   ```env
   OPENAI_PROXY=http://proxy.example.com:8080
   ```
   
   Или для HTTPS:
   ```env
   OPENAI_PROXY=https://proxy.example.com:8080
   ```

3. Если прокси требует аутентификацию:
   ```env
   OPENAI_PROXY=http://username:password@proxy.example.com:8080
   ```

### Вариант 2: SOCKS прокси

Для SOCKS прокси используйте формат:
```env
OPENAI_PROXY=socks5://proxy.example.com:1080
```

### Вариант 3: Альтернативный API endpoint

Если у вас есть доступ к альтернативному API endpoint (например, через прокси-сервис):

```env
OPENAI_BASE_URL=https://api.openai-proxy.com/v1
```

## Где получить прокси?

### Бесплатные варианты:
- Публичные прокси-списки (не рекомендуется для продакшена)
- VPN сервисы с прокси-поддержкой

### Платные варианты:
- Специализированные прокси-провайдеры
- VPN сервисы с выделенными IP
- Прокси-сервисы для API (например, для OpenAI)

## Пример настройки .env

```env
# Telegram Bot Token
TELEGRAM_BOT_TOKEN=your_token_here

# OpenAI API Key
OPENAI_API_KEY=your_key_here

# Прокси для OpenAI (опционально)
OPENAI_PROXY=http://proxy.example.com:8080

# Альтернативный базовый URL (опционально)
# OPENAI_BASE_URL=https://api.openai-proxy.com/v1
```

## Проверка работы

После настройки прокси:

1. Перезапустите бота:
   ```powershell
   .\stop_bot.ps1
   .\start_bot.ps1
   ```

2. Попробуйте отправить сообщение боту в Telegram

3. Если ошибка 403 исчезла - прокси работает!

## Альтернативные решения

### 1. Использование VPN

Включите VPN перед запуском бота. Это изменит ваш IP-адрес на адрес из поддерживаемого региона.

### 2. Использование альтернативных моделей

Можно переключиться на другие LLM провайдеры, которые доступны в вашем регионе:
- Anthropic Claude (если доступен)
- Google Gemini (если доступен)
- Локальные модели через Ollama

### 3. Использование облачных серверов

Запустите бота на облачном сервере (VPS) в регионе, где доступен OpenAI API.

## Устранение неполадок

### Прокси не работает

1. Проверьте формат URL прокси
2. Убедитесь, что прокси доступен и работает
3. Проверьте логи бота на наличие ошибок подключения

### Медленная работа

Прокси может замедлить работу. Попробуйте:
- Более быстрый прокси-сервер
- Прокси ближе к серверам OpenAI
- Увеличить таймаут (уже установлен на 60 секунд)

## Безопасность

⚠️ **Важно:** Не используйте публичные прокси для продакшена, так как они могут:
- Перехватывать ваши API ключи
- Логировать ваши запросы
- Быть ненадежными

Используйте только доверенные прокси-сервисы.

