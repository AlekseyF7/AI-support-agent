# Настройка отправки тикетов специалистам

## Как это работает

1. Пользователь пишет вопрос боту
2. Бот создает тикет и отправляет его в группу поддержки
3. Специалист видит тикет с кнопками управления
4. Специалист отвечает на тикет через Reply на сообщение
5. Ответ автоматически отправляется пользователю

## Настройка

### Шаг 1: Создайте группу в Telegram

1. Создайте новую группу в Telegram (например, "Поддержка банка")
2. Добавьте в группу вашего бота
3. Сделайте бота администратором группы (важно для отправки сообщений)

### Шаг 2: Получите ID группы

**Способ 1: Через getUpdates API**

1. Откройте в браузере:
   ```
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
   ```
   Замените `<YOUR_BOT_TOKEN>` на токен вашего бота.

2. Отправьте любое сообщение в группу с ботом

3. Обновите страницу в браузере

4. Найдите в ответе:
   ```json
   "chat": {
       "id": -1001234567890,
       "title": "Поддержка банка",
       "type": "supergroup"
   }
   ```

5. ID группы: `-1001234567890` (с минусом!)

**Способ 2: Через бота @getidsbot**

1. Добавьте @getidsbot в группу
2. Бот напишет ID группы
3. Удалите @getidsbot из группы

### Шаг 3: Добавьте ID в .env

Откройте файл `.env` и добавьте:

```env
SUPPORT_CHAT_ID=-1001234567890
```

### Шаг 4: Перезапустите бота

```powershell
.\stop_bot.ps1
.\start_bot.ps1
```

## Функции для специалистов

### Ответ на тикет

1. Найдите сообщение с тикетом в группе
2. Нажмите Reply (ответить) на это сообщение
3. Напишите ответ
4. Ответ автоматически будет отправлен пользователю

### Кнопки управления

- **В работу** - отметить, что тикет взят в работу
- **Ожидание** - ожидается ответ пользователя
- **Решено** - проблема решена
- **Закрыть** - закрыть тикет
- **Эскалация** - передать на следующую линию

При нажатии кнопки:
- Статус тикета обновляется
- Пользователь получает уведомление

## Несколько линий поддержки

Можно настроить отдельные группы для разных линий:

```env
# Общая группа (если линейные не настроены)
SUPPORT_CHAT_ID=-1001234567890

# Отдельные группы для линий
SUPPORT_LINE_1_CHAT_ID=-100111111111  # Service Desk
SUPPORT_LINE_2_CHAT_ID=-100222222222  # Technical Support
SUPPORT_LINE_3_CHAT_ID=-100333333333  # Expert Support
```

Тикеты будут автоматически направляться в нужную группу в зависимости от критичности.

## Проверка работы

1. Напишите боту тестовое сообщение, например: "Не могу войти в интернет-банк"
2. Проверьте, что тикет появился в группе поддержки
3. Ответьте на тикет в группе через Reply
4. Проверьте, что ответ пришел пользователю

## Возможные проблемы

### Тикеты не отправляются в группу

1. Проверьте, что `SUPPORT_CHAT_ID` указан в `.env`
2. Убедитесь, что бот добавлен в группу
3. Проверьте, что бот является администратором группы
4. ID группы должен быть с минусом (например, `-1001234567890`)

### Ответы не доставляются пользователям

1. Убедитесь, что отвечаете через Reply на сообщение тикета
2. Проверьте, что пользователь не заблокировал бота

### Кнопки не работают

1. Убедитесь, что бот - администратор группы
2. Перезапустите бота

