import asyncio
import logging
from rag_system import RAGSystem

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger("knowledge_loader")

# Data parsed from Sberbank Official FAQ and Help Pages
# Source: sberbank.ru/ru/person/help
FAQ_DATA = [
    # --- –í–•–û–î –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ ---
    {
        "question": "–ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏ –≤ –°–±–µ—Ä–±–∞–Ω–∫ –û–Ω–ª–∞–π–Ω. –ó–∞–±—ã–ª –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å.",
        "answer": "–ï—Å–ª–∏ –≤—ã –∑–∞–±—ã–ª–∏ –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏¬ª –∏–ª–∏ ¬´–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø¬ª –Ω–∞ —ç–∫—Ä–∞–Ω–µ –≤—Ö–æ–¥–∞. –í–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –Ω–æ–º–µ—Ä –¥–µ–π—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä—Ç—ã. –°–ª–µ–¥—É–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º: –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–º—Å-–∫–æ–¥–æ–º –∏ –ø—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å. –¢–∞–∫–∂–µ –ø–∞—Ä–æ–ª—å –º–æ–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å –≤ –±–∞–Ω–∫–æ–º–∞—Ç–µ –°–±–µ—Ä–ë–∞–Ω–∫–∞."
    },
    {
        "question": "–û—à–∏–±–∫–∞ '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å' –ø—Ä–∏ –≤—Ö–æ–¥–µ.",
        "answer": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–∫–ª–∞–¥–∫—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –Ω–µ –Ω–∞–∂–∞—Ç–∞ –ª–∏ –∫–ª–∞–≤–∏—à–∞ CapsLock. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—ã, –Ω–æ –≤–æ–π—Ç–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è, –≤–æ–∑–º–æ–∂–Ω–æ, –≤–∞—à–∞ —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤–≤–æ–¥–∞. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 15 –º–∏–Ω—É—Ç –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–∞."
    },
    {
        "question": "–ö–∞–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –°–±–µ—Ä–±–∞–Ω–∫ –û–Ω–ª–∞–π–Ω?",
        "answer": "–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–∞ –∫–∞—Ä—Ç–∞ –°–±–µ—Ä–ë–∞–Ω–∫–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –°–ú–°-–±–∞–Ω–∫–æ–º (–ú–æ–±–∏–ª—å–Ω—ã–º –±–∞–Ω–∫–æ–º). –ó–∞–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç –∏–ª–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –Ω–∞–∂–º–∏—Ç–µ ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∫–æ–¥–æ–º –∏–∑ –°–ú–°. –ó–∞—Ç–µ–º –ø—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å."
    },

    # --- –ú–û–ë–ò–õ–¨–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ---
    {
        "question": "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –°–±–µ—Ä–±–∞–Ω–∫ –û–Ω–ª–∞–π–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç / –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è / –æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.",
        "answer": "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. 2. –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω VPN ‚Äî –≤—ã–∫–ª—é—á–∏—Ç–µ –µ–≥–æ (—Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥). 3. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ (—á–µ—Ä–µ–∑ RuStore, —Å–∞–π—Ç –±–∞–Ω–∫–∞ –∏–ª–∏ –æ—Ñ–∏—Å—ã). 4. –ï—Å–ª–∏ –≤–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –≤–µ–±-–≤–µ—Ä—Å–∏–µ–π —Å–∞–π—Ç–∞."
    },
    {
        "question": "–ì–¥–µ —Å–∫–∞—á–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –°–±–µ—Ä–ë–∞–Ω–∫ –Ω–∞ Android –∏ iPhone?",
        "answer": "–ù–∞ Android: —Å–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ sberbank.ru –∏–ª–∏ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–æ–≤ RuStore, Huawei AppGallery. –ù–∞ iPhone: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–∏ –°–±–µ—Ä–ë–∞–Ω–∫–∞ –∏–ª–∏ –≤—ã–∑–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞."
    },
    {
        "question": "–ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –°–ú–° —Å –∫–æ–¥–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.",
        "answer": "1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω. 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ –ª–∏ –ø–∞–º—è—Ç—å –°–ú–°. 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫. 4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏–º-–∫–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ —Å–≤—è–∑–∏ –∏–ª–∏ –±–∞–Ω–∫–∞."
    },

    # --- –ö–ê–†–¢–´ –ò –°–ß–ï–¢–ê ---
    {
        "question": "–ù–µ –≤–∏–∂—É –∫–∞—Ä—Ç—É –∏–ª–∏ —Å—á–µ—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ü—Ä–æ–ø–∞–ª –ø—Ä–æ–¥—É–∫—Ç.",
        "answer": "–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª ¬´–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø—ã¬ª -> ¬´–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤¬ª. –í–æ–∑–º–æ–∂–Ω–æ, —Å—á–µ—Ç —Å–∫—Ä—ã—Ç. –¢–∞–∫–∂–µ –ø—Ä–æ–¥—É–∫—Ç—ã –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è, –µ—Å–ª–∏ –ø–æ–º–µ–Ω—è–ª–∏—Å—å –≤–∞—à–∏ –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –æ—Ñ–∏—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö."
    },
    {
        "question": "–ö–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É (–ø–æ—Ç–µ—Ä—è–ª/—É–∫—Ä–∞–ª–∏)?",
        "answer": "–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É -> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å. –ü–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É: –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞ 900 –∏ —Å–∫–∞–∂–∏—Ç–µ ¬´–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É¬ª. –ü–æ –°–ú–°: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ 900 —Å–ª–æ–≤–æ –ë–õ–û–ö–ò–†–û–í–ö–ê –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã –∫–∞—Ä—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ë–õ–û–ö–ò–†–û–í–ö–ê 1234)."
    },

    # --- –ü–ï–†–ï–í–û–î–´ –ò –õ–ò–ú–ò–¢–´ ---
    {
        "question": "–ö–∞–∫–∏–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥—ã —á–µ—Ä–µ–∑ –°–ë–ü (–ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞) –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏?",
        "answer": "–ö–ª–∏–µ–Ω—Ç—ã –°–±–µ—Ä–ë–∞–Ω–∫–∞ –º–æ–≥—É—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –°–ë–ü –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏ –¥–æ 100 000 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü. –°–≤—ã—à–µ —ç—Ç–æ–π —Å—É–º–º—ã –∫–æ–º–∏—Å—Å–∏—è —Å–æ—Å—Ç–∞–≤–∏—Ç 0.5% –æ—Ç —Å—É–º–º—ã –ø–µ—Ä–µ–≤–æ–¥–∞, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 1500 —Ä—É–±–ª–µ–π."
    },
    {
        "question": "–ö–∞–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è –∑–∞ –ø–µ—Ä–µ–≤–æ–¥—ã –≤–Ω—É—Ç—Ä–∏ –°–±–µ—Ä–ë–∞–Ω–∫–∞?",
        "answer": "–ü–µ—Ä–µ–≤–æ–¥—ã –∫–ª–∏–µ–Ω—Ç–∞–º –°–±–µ—Ä–ë–∞–Ω–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 50 000 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü. –° –ø–æ–¥–ø–∏—Å–∫–æ–π –°–±–µ—Ä–ü—Ä–∞–π–º –ª–∏–º–∏—Ç—ã –≤—ã—à–µ."
    },

    # --- –ö–û–ù–¢–ê–ö–¢–´ ---
    {
        "question": "–ö–∞–∫ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –≤ –±–∞–Ω–∫? –ù–æ–º–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–∏.",
        "answer": "900 ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Å –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–æ –†–æ—Å—Å–∏–∏. +7 (495) 500-55-50 ‚Äî –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ –∏–∑ –ª—é–±–æ–π —Ç–æ—á–∫–∏ –º–∏—Ä–∞. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –°–±–µ—Ä–ë–∞–Ω–∫ –û–Ω–ª–∞–π–Ω."
    }
]

async def load_knowledge():
    print("üöÄ Initializing RAG System...")
    
    # Force initialize RAG logic (create client and collection)
    rag = RAGSystem()
    
    print(f"üìö Loading {len(FAQ_DATA)} parsed documents to ChromaDB...")
    
    documents = [item["answer"] for item in FAQ_DATA]
    # Metadata helps in filtering or debugging
    metadatas = [{"source": "sber_faq_parsed", "question": item["question"]} for item in FAQ_DATA]
    # Unique IDs for each chunk
    ids = [f"faq_parsed_{i}" for i in range(len(FAQ_DATA))]
    
    try:
        # Upsert allows updating existing IDs or adding new ones
        rag.collection.upsert(
            documents=documents,
            metadatas=metadatas,
            ids=ids
        )
        print("‚úÖ Data successfully loaded into Knowledge Base!")
        
        # Verify
        count = rag.collection.count()
        print(f"üìä Total documents in collection: {count}")
        print("üí° Now the bot knows about: Login errors, App install, Lost cards, Limits, etc.")
        
    except Exception as e:
        print(f"‚ùå Error loading data: {e}")

if __name__ == "__main__":
    asyncio.run(load_knowledge())
